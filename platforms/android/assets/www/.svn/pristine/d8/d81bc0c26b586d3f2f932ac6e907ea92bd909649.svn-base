<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>Insert title here</title>
    <script src="js/include.js"></script>
    <link>
    <link href="css/star-rating.css" media="all" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link href="icon/iconfont.css"  rel="stylesheet" type="text/css">
    <style type="text/css">
    
    hr {
        margin: 0.3em 0em;
        padding: 0px;
        border-top: 1px solid #e8e8e8;
    }
    
    .item {
        margin-top: 1em;
        width: 100%;
    }
    
    .small {
        font-size: 1em;
        padding-left: 1.5em;
        color: #7a7a7a;
        line-height: 2em;
    }
    
    .margin {
        margin: 0em;
    }
    
    

    .am-list {
	    margin-bottom:0;
	    padding-left: 0;
	}
	.am-list>li {
		border-top:none;
	    border-bottom:1px solid #e4e4e4;
	    border-width: 1px 0;
	    overflow: hidden;
	    padding:10px 15px 10px 0;
	    margin: 0;
	}
	.am-list>li p{
		margin: 0;
		
	}
	.am-list>li p:first-child{
		float:left;
		color:#666666;
		font-size: 2rem;
	}
	.am-list>li:last-child{
		border-bottom:none;
		
	}
	.am-list>li p:last-child{
		float:right;
		color:#767676;
		margin-top:5px;
		
	}
	.am-list>li p i{
		border:1px solid #cccccc;
		font-style: normal;
		float:left;
		margin-left: 0.5rem;
		width: 30px;
		height:30px;
		line-height: 30px;
		text-align: center;
		font-size: 1.5rem;
	}
	.icon-jiahao{
		color:#ff5b35 
	}
	
	.am-list>li p:last-child span{
		color:#ff0000;
		font-weight: bold;
	}
	.am-radio-inline {
	    width: 100%;
	    border-bottom: 1px solid #e4e4e4;
	    padding: 10px 15px;
	}
	.am-radio-inline:last-child{
		border-bottom:none
	}
	#car-goods {
	padding: 0;
}

.minus-wp, .add-wp {
	height: 36px;
	line-height: 36px;
	width: 36px;
	display: inline-block;
	text-align: center;
	background: transparent;
	border: 1px solid #8b8b8b;
	cursor: pointer;
	color: #8b8b8b;
}

.buy-num {
	width: 40px;
	text-align: center;
	height: 36px;
	line-height: 36px;
	background: transparent;
	-webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, .05);
	box-shadow: inset 0 1px 3px rgba(0, 0, 0, .05);
	border: none;
	border-top: 1px solid #8b8b8b;
	border-bottom: 1px solid #8b8b8b;
	border-top: 1px solid #8b8b8b;
	color: #323232;
}

.clearfix {
	zoom: 1;
}

.fleft {
	float: left;
}

i-minus {
	background-position: -74px -738px;
}

.i-add {
	background-position: -48px -738px;
}

.i-add, .i-minus {
	width: 15px;
	height: 15px;
	vertical-align: middle;
}

input[type=checkbox], input[type=radio] {
	-webkit-appearance: none;
	appearance: none;
	width: 13px;
	height: 13px;
	margin: 0;
	cursor: pointer;
	vertical-align: bottom;
	background: #fff;
	border: 1px solid B9BBBE;
	-webkit-border-radius: 1px;
	-moz-border-radius: 1px;
	border-radius: 1px;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	position: relative;
}

input[type=checkbox]:active, input[type=radio]:active {
	border: none;
	background: #ebebeb;
}

input[type=checkbox]:hover {
	border: none;
}

input[type=checkbox] {
	border: none;
	width: 20px;
	height: 20px;
	content: url('img/normal_addr.png');
	background: transparent;
}

input[type=checkbox]:checked, input[type=radio]:checked {
	z-index: 100;
	width: 20px;
	height: 20px;
	content: url('img/default_addr.png');
}

input[type=checkbox]:checked::after {
	width: 20px;
	height: 20px;
	content: url('img/default_addr.png');
	display: block;
}

input[type=checkbox]:focus {
	width: 20px;
	height: 20px;
	outline: none;
	border-color: #4d90fe;
}

.total_price_div {
	position: fixed;
	bottom: 49px;
	width: 100%;
	color: white;
	height: 60px;
	line-height: 60px;
	background: #fff;
	color: #333;
	z-index: 1000;
	font-family: sumsun;
	border-bottom:1px solid #ddd;
}

.buy-btn {
	float: right;
	background: #ff9402;
	color: #fff;
	padding: 0 6px;
	font-size: 1.2em
}

.del-btn {
	float: right;
	background: #ff3b30;
	color: #fff;
	padding: 0 24px;
	font-size: 1.2em
}

input[name=modify-num] {
	border: 1px solid #eee;
	line-height: 2em;
	height: 2em;
	background: transparent;
	width: 60px;
	outline: none;
	text-align: center;
	font-family: sumsun;
}
	
    </style>
</head>

<body>
    <header data-am-widget="header" class="am-header am-header-default am-header-fixed yhb-title">
        <div class="am-header-left am-header-nav">
			<a href="javascript:mi_exit(-1);" style="text-align: left">
				<i class="iconfont icon-fanhuijiantou1"></i> 
			</a>
		</div>
        <h1 class="am-header-title">提交订单</h1>
    </header>
    <div class="am-g" style="background-color: white;padding:0 0 0 15px;margin-top:10px;border-top:1px solid #d8d8d8;border-bottom:1px solid #d8d8d8;">
		<div class="am-form-graamoup">
			<ul class="am-list" style="margin-left:0;">
				<li>
					<p id="name"></p>
					<p style="font-size: 1.6rem; font-weight: bold;" >￥<span id="price"></span></p>
				</li>
			    <li>
					<p id="num">数量</p>
					<div class ="" style="font-size: 14px;float: right;text-align: center;border-radius: 2px;padding:0 0.6em 0 0;">
					<span class="minus-wp fleft" >
						<span class="am-icon-minus"></span>
					</span>
						<span type="text" font-family="simsun" class="buy-num buynum fleft">1</span>
						<span class="add-wp fleft" >
						<span class="am-icon-plus" ></span>
						</span>
					</div>	
				</li>
				<li>
					<p>小计</p>
					<p style="font-size: 1.6rem;">￥<span id="total"></span></p>
				</li>
			</ul>
		</div>
	</div>
	<div class="am-g" style="background-color: white;padding:0 0 0 15px;margin-top:10px;border-top:1px solid #d8d8d8;border-bottom:1px solid #d8d8d8; margin-bottom: 10px;">
		<div class="am-g">
			<ul class="am-list" style="margin-left:0;">
				<li>
					<p>积分规则</p>
					<p><span style="border: 1px solid #ff5b35; border-radius: 5px; padding:5px 10px;font-size: 1rem;" id="guize"></span></p>
				</li>
				<li>
					<p>可用积分</p>
					<p>已有<span id="jifen"></span></p>
				</li>
			    <li>
					<p>订单价格</p>
					<p style="font-size: 1.6rem;">￥<span id="total1"></span></p>
				</li>
			</ul>
		</div>
	</div>
	
	<div id="done" style="margin-top: 2em" class="am-u-sm-12">
        <input type="button" name="" value="确认提交" onclick="done()" class="am-btn am-btn-sm am-fl" style="border-radius: 6px;border: none;width: 100%;height: 3em; font-size: 1em; color: white; outline: none;background-color: lightskyblue ;background-size: cover;background-repeat: no-repeat;">
    </div>
    <div class="am-modal am-modal-confirm" tabindex="-1"
		id="modify-buy-num">
		<div class="am-modal-dialog">
			<div class="am-modal-hd">修改购买数量</div>
			<div class="am-modal-bd">
				<input name='modify-num'
					onkeyup="var m=value.replace(/[^\d]/g,'');if(m <1){value= 1;}if(m>=100){value = 99}"
					onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))">
			</div>
			<div class="am-modal-footer">
				<span class="am-modal-btn" data-am-modal-cancel>取消</span> <span
					class="am-modal-btn" data-am-modal-confirm>确定</span>
			</div>
		</div>
	</div>
    
</body>

<script type="text/javascript">
	var shangpinID = getParameter("shangpinID");
	var userid = window.localStorage.getItem('userid');
	var token = window.localStorage.getItem('token');
	var isLogin = true;
	var shoucangStatus = false;
	var quantity = 1;

	if (userid == null || userid == "null" || userid == "") {
		isLogin = false;
	} else {
		isLogin = true;
	}
	jQuery(document).ready(function() {
		goumai();
	});
	function goumai() {
		if(!isLogin){
			$('#errmsg').text("未登录");
            $('#my-alert').modal();
			window.location.href="login.html"
		}
		$.ajax({
			type: "post",
			url:baseurl("APPGOUMAI.do"),
			dataType: "jsonp",
			data:{
				"shangpinID": shangpinID,
				"yonghuID":userid,
				"token":token
			},
			jsonp: "callback",
			jsonpCallback: "fenleilist",
			success: function(json) {
				var name = json.goodsName;
				var jifenguize = json.jifenguize;
				var jifen = json.jifen;
				var price = json.price;			
				$('#name').html(name);
				$('#guize').html(jifenguize);
				$('#jifen').html(jifen);
				$('#price').html(price);
				$('#total').html(price);
				$('#total1').html(price);
				initShopCar();
										
			},
			error: function() {
			
			}
		});			
	}
	function initShopCar() {
		$(".minus-wp").click(minusBuyNum);
		//购买数量加
		$(".add-wp").click(addBuyNum);
		$(".buy-num").click(modifyBuyNum);
		//$('.buy-btn').on('click', goSettlement);
	}
	//购买数量减
	function minusBuyNum() {
		var self = this;
		editQuantity(self, "minus");
	}
	//购买数量加
	function addBuyNum() {
		var self = this;
		editQuantity(self, "add");
	}
	//修改购买数量
	var modifyBuyNumSpan;
	function modifyBuyNum() {
		modifyBuyNumSpan = this;
		$('input[name="modify-num"]').val(modifyBuyNumSpan.textContent);
		$('#modify-buy-num').modal({
			relatedTarget : this,
			onConfirm : modifyConfirm,
			// closeOnConfirm: false,
			onCancel : function() {
			}
		});
	}
	function modifyConfirm() {
		if (typeof (modifyBuyNumSpan) != 'undefined') {
			var num = $('input[name="modify-num"]').val();
			modifyBuyNumSpan.textContent = num;
			editQuantity(modifyBuyNumSpan, 'modify');
		}
	}
	//购买数量增或减，请求获取新的价格
	function editQuantity(self, type) {
		//var sPrents = $(self).parents(".cart-litemw-cnt")
		//var goods_id = sPrents.attr("goods_id");
		var numInput = $(".buy-num");
		var priceSpan = $("#price").html();
		//var totalPriceSpan = $(".goods-total-price");
		var buynum = parseInt(numInput.html());
		//var goodsprice = parseInt(priceSpan.html());
		
		if (type == "add") {
			if (buynum < 99) {
				quantity = parseInt(buynum + 1);
			} else {
				new Toast({
					context : $('body'),
					message : '购买数量需小于99'
				}).show();
				return;
			}
			// 
		} else if (type == "minus") {
			if (buynum > 1) {
				quantity = parseInt(buynum - 1);
			} else {
				new Toast({
					context : $('body'),
					message : '购买数量必须大于1'
				}).show();
				return;
			}
		} else {
			quantity = parseInt(buynum);
		}
		numInput.html(quantity);
		//window.localStorage.setItem(shangpinID, quantity);
		$("#total").html(priceSpan * quantity);
		$("#total1").html(priceSpan * quantity);
		//calculatorTotalPrice();
	}
	function done(){
		$.ajax({
			type: "post",
			url:baseurl("APPSAVEORDER.do"),
			dataType: "jsonp",
			data:{
				"shangpinID": shangpinID,
				"yonghuID":userid,
				"token":token,
				"shangpinNum":quantity
			},
			jsonp: "callback",
			jsonpCallback: "fenleilist",
			success: function(json) {
				var dingdanID = json.dingdanID;
				goJiesuan(dingdanID);
										
			},
			error: function() {
			
			}
		});	
		
	}
	function goJiesuan(dingdanID) {
		window.location.href = "jiesuan.html?dingdanID="+dingdanID;
	}
	
	
</script>

</html>
